<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>从JS接口到拿下大量学校的超级管理员权限 | X1ly?S</title><meta name="author" content="X1ly?S"><meta name="copyright" content="X1ly?S"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="信息收集首先通过网站标题搞清楚了网站的性质，是一个某地的站群系统，集合管理着大量的子网站  通过Wappalyzer了解使用的重点技术有：Java、Swagger-UI、Spring、Vue.js、Webpack 而常用的前后端分离架构正是Vue.js + Java(SpringBoot) 于是可以初步判断该站点是前后端分离架构的 而前后端分离的架构，常涉及到前后端之间的数据的传递与调用，如果接口">
<meta property="og:type" content="article">
<meta property="og:title" content="从JS接口到拿下大量学校的超级管理员权限">
<meta property="og:url" content="https://x1lys.github.io/2024/08/20/%E4%BB%8EJS%E6%8E%A5%E5%8F%A3%E5%88%B0%E6%8B%BF%E4%B8%8B%E5%A4%A7%E9%87%8F%E5%AD%A6%E6%A0%A1%E7%9A%84%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/index.html">
<meta property="og:site_name" content="X1ly?S">
<meta property="og:description" content="信息收集首先通过网站标题搞清楚了网站的性质，是一个某地的站群系统，集合管理着大量的子网站  通过Wappalyzer了解使用的重点技术有：Java、Swagger-UI、Spring、Vue.js、Webpack 而常用的前后端分离架构正是Vue.js + Java(SpringBoot) 于是可以初步判断该站点是前后端分离架构的 而前后端分离的架构，常涉及到前后端之间的数据的传递与调用，如果接口">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://x1lys.github.io/img/1.jpg">
<meta property="article:published_time" content="2024-08-20T08:26:18.000Z">
<meta property="article:modified_time" content="2025-01-10T08:30:25.984Z">
<meta property="article:author" content="X1ly?S">
<meta property="article:tag" content="渗透案例">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://x1lys.github.io/img/1.jpg"><link rel="shortcut icon" href="/img/999.png"><link rel="canonical" href="https://x1lys.github.io/2024/08/20/%E4%BB%8EJS%E6%8E%A5%E5%8F%A3%E5%88%B0%E6%8B%BF%E4%B8%8B%E5%A4%A7%E9%87%8F%E5%AD%A6%E6%A0%A1%E7%9A%84%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":300,"languages":{"author":"作者: X1ly?S","link":"链接: ","source":"来源: X1ly?S","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '从JS接口到拿下大量学校的超级管理员权限',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/30.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/11.jpg" onerror="onerror=null;src='/img/47.jpg'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">90</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">50</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-cogs"></i><span> 技术</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-list-alt"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-heart"></i><span> 爱好</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E5%85%AD%E7%88%BB/"><i class="fa-fw fa-solid fa-bars"></i><span> 六爻</span></a></li><li><a class="site-page child" href="/categories/%E5%86%99%E4%BD%9C/"><i class="fa-fw fas fa-pencil-alt"></i><span> 写作</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i><span> 电影</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-users"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/msg/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/1.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">X1ly?S</span></a><a class="nav-page-title" href="/"><span class="site-name">从JS接口到拿下大量学校的超级管理员权限</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-cogs"></i><span> 技术</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-list-alt"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa-solid fa-heart"></i><span> 爱好</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/%E5%85%AD%E7%88%BB/"><i class="fa-fw fa-solid fa-bars"></i><span> 六爻</span></a></li><li><a class="site-page child" href="/categories/%E5%86%99%E4%BD%9C/"><i class="fa-fw fas fa-pencil-alt"></i><span> 写作</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-film"></i><span> 电影</span></a></li><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fas fa-comments"></i><span> 说说</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa-solid fa-users"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/msg/"><i class="fa-fw fas fa-envelope"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">从JS接口到拿下大量学校的超级管理员权限</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-20T08:26:18.000Z" title="发表于 2024-08-20 16:26:18">2024-08-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-01-10T08:30:25.984Z" title="更新于 2025-01-10 16:30:25">2025-01-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B8%97%E9%80%8F%E6%A1%88%E4%BE%8B/">渗透案例</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">3.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>10分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2024/08/20/%E4%BB%8EJS%E6%8E%A5%E5%8F%A3%E5%88%B0%E6%8B%BF%E4%B8%8B%E5%A4%A7%E9%87%8F%E5%AD%A6%E6%A0%A1%E7%9A%84%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/#post-comment"><span class="waline-comment-count" data-path="/2024/08/20/%E4%BB%8EJS%E6%8E%A5%E5%8F%A3%E5%88%B0%E6%8B%BF%E4%B8%8B%E5%A4%A7%E9%87%8F%E5%AD%A6%E6%A0%A1%E7%9A%84%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><div id="post-outdate-notice" data="{&quot;limitDay&quot;:365,&quot;messagePrev&quot;:&quot;It has been&quot;,&quot;messageNext&quot;:&quot;days since the last update, the content of the article may be outdated.&quot;,&quot;postUpdate&quot;:&quot;2025-01-10 16:30:25&quot;}" hidden></div><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>首先通过<strong>网站标题</strong>搞清楚了网站的性质，是一个某地的<strong>站群系统</strong>，集合管理着<strong>大量的子网站</strong></p>
<p><img src="https://s2.loli.net/2024/10/22/DI3otzMG5pSZcAC.png" alt="image"></p>
<p>通过<strong>Wappalyzer</strong>了解使用的重点技术有：<strong>Java、Swagger-UI、Spring、Vue.js、Webpack</strong></p>
<p>而常用的<strong>前后端分离</strong>架构正是<strong>Vue.js + Java(SpringBoot)</strong></p>
<p>于是可以初步判断该站点是<strong>前后端分离架构</strong>的</p>
<p><strong>而前后端分离的架构，常涉及到前后端之间的数据的传递与调用，如果接口鉴权未做好，很容易出现API接口未授权的安全漏洞</strong></p>
<h2 id="基本测试流程"><a href="#基本测试流程" class="headerlink" title="基本测试流程"></a>基本测试流程</h2><p>简单的信息收集之后，接下来开始走一遍登录框的基本测试流程</p>
<p>万能密码</p>
<p>弱口令</p>
<p>用户名枚举 </p>
<p>前端登录检验绕过</p>
<p>找前端源码泄露</p>
<p>……</p>
<p>这些基本流程走完后，不出所料，没有任何发现</p>
<p>那么既然是前后端分离的架构，当然得测一测JS中未授权接口了，于是展开对JS中未授权接口的详细测试</p>
<h2 id="API接口提取"><a href="#API接口提取" class="headerlink" title="API接口提取"></a>API接口提取</h2><p>对于API接口的测试，前面也提过很多次了，我常用的工具是FindSomeThing、URLFinder并结合手工的方式去测试的</p>
<p>ok，先用FindSomeThing看看接口</p>
<p><img src="https://s2.loli.net/2024/10/22/13d6LZGniHUQzxF.png" alt="image"></p>
<p>好家伙，一个接口也没有，这种时候不要慌，前面信息收集提到了站点使用了<strong>Webpack</strong>，那么JS就被压缩打包了，这可能对该工具提取API接口有影响，或者是该工具的匹配接口的正则不适合于当前站点的写法的原因</p>
<p><strong>这种情况可以选择用URLFinder看看能不能提取成功，一般是可以的，但是这个工具爬取功能太强大了，爬取到API接口的同时，也会爬取到大量无用的数据和垃圾数据，之后仍然需要手工去把有效的接口筛选出来，数据多的时候反而效率不如手工直接找接口来得快，而且，还有一点，有时API接口不完整，需要拼接baseURL、baseAPI，该工具无法做到正确地拼接接口，也是需要手工去拼接的</strong></p>
<p>看看js文件</p>
<p><img src="https://s2.loli.net/2024/10/22/uDEty231kzFg6Wn.png" alt="image"></p>
<p><img src="https://s2.loli.net/2024/10/22/gR64J7ZQd9cwuI3.png" alt="image"></p>
<p>果然有baseURL，是需要手动拼接接口的，于是我选择<strong>手工+自写小脚本来进行API接口的测试</strong></p>
<p>findAPI.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.132 Safari/537.36Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.90 Safari/537.36&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">fileurl=sys.argv[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">filemkdir=fileurl.split(<span class="string">&#x27;_&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filemkdir):</span><br><span class="line">    os.makedirs(filemkdir)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载chunk.js</span></span><br><span class="line"><span class="comment"># with open (str(fileurl)) as furl:</span></span><br><span class="line"><span class="comment">#   url=furl.readlines()</span></span><br><span class="line"><span class="comment">#   print(str(url)+&quot;---is---downloading&quot;)</span></span><br><span class="line"><span class="comment">#   for url in url:</span></span><br><span class="line"><span class="comment">#       url=url.strip(&#x27;\n&#x27;)</span></span><br><span class="line"><span class="comment">#       file=url.split(&#x27;/&#x27;)[-1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#       resp = requests.get(url)</span></span><br><span class="line"><span class="comment">#       html = resp.text</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#       with open (&quot;./&quot;+filemkdir+&quot;/&quot;+file,&quot;a&quot;,encoding=&quot;utf-8&quot;) as f1:</span></span><br><span class="line"><span class="comment">#           f1.write(html)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#get path  + 路径名称</span></span><br><span class="line">paths=[]</span><br><span class="line"><span class="keyword">for</span> dirpath, dirnames, filenames <span class="keyword">in</span> os.walk(<span class="string">&#x27;./&#x27;</span>+filemkdir):</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> filenames:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;./&quot;</span>+filemkdir+<span class="string">&quot;/&quot;</span>+file,<span class="string">&quot;r&quot;</span>,encoding=<span class="string">&#x27;gb18030&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>) <span class="keyword">as</span> f2:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                line=f2.readlines()</span><br><span class="line">                <span class="keyword">for</span> line <span class="keyword">in</span> line:</span><br><span class="line">                    line=line.strip(<span class="string">&#x27;\n&#x27;</span>).strip(<span class="string">&#x27;\t&#x27;</span>)</span><br><span class="line">                    <span class="comment">#print(line)</span></span><br><span class="line">                    p =  re.findall(<span class="string">&#x27;&#x27;&#x27;([&#x27;&quot;]\/[^][^&gt;&lt; \)\(\&#123;\&#125;]*?[&#x27;&quot;])&#x27;&#x27;&#x27;</span>,line)</span><br><span class="line">                    <span class="comment">#print(p)</span></span><br><span class="line">                    <span class="keyword">if</span> p != <span class="literal">None</span>:</span><br><span class="line">                        <span class="comment">#print(p)</span></span><br><span class="line">                        <span class="keyword">for</span> path <span class="keyword">in</span> p:</span><br><span class="line">                            path=path.replace(<span class="string">&#x27;:&quot;&#x27;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">                            paths.append(file+<span class="string">&quot;---&quot;</span>+path)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> <span class="built_in">sorted</span>(<span class="built_in">set</span>(paths)):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span> (fileurl+<span class="string">&#x27;_path.txt&#x27;</span>,<span class="string">&quot;a+&quot;</span>,encoding=<span class="string">&#x27;gb18030&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>) <span class="keyword">as</span> paths:</span><br><span class="line">        paths.write(var+<span class="string">&#x27;\n&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>先把base路径单独提取出来</p>
<p>然后再去提取后半段的API接口作为字典</p>
<p>然后再放进burp里批量跑一下接口，固定一个base路径然后跑字典，缺参数就去找参数或者猜测FUZZ，请求方法不对就改方法，以此类推</p>
<p>剔除掉一些401的接口，这些接口就是正确地鉴了权的，基本不用看了，除非校验字段可伪造(JWT漏洞，弱cookie等等)</p>
<p>剔除掉一些404的接口，403的接口可以尝试绕一下</p>
<p>然后根据测试结果，手工分类了一下API接口</p>
<p><img src="https://s2.loli.net/2024/10/22/uSHR1G6jqQK8xmn.png" alt="image"></p>
<p><img src="https://s2.loli.net/2024/10/22/fRdUnq23CNruSI8.png" alt="image"></p>
<p>可以看到收获还是颇丰的，有些接口能<strong>直接看到大量的数据</strong>，但是不是什么很敏感的数据，接下来，就是逐一对这些接口进行<strong>单独测试</strong>，首选一些比较重要的接口，比如upload，password，username，admin，manager，upgrade，newpasswd，post等等之类的</p>
<h2 id="API接口测试"><a href="#API接口测试" class="headerlink" title="API接口测试"></a>API接口测试</h2><blockquote>
<p>（所有接口已虚化）</p>
</blockquote>
<p>最开始，这个接口没有填任何参数就SQL报错</p>
<p><img src="https://s2.loli.net/2024/10/22/TkeH7LWN4bMnga1.png" alt="image"></p>
<p>那么这里大概就是缺少一些必要的参数了</p>
<p>于是首先我回到JS源码中去找，全局搜索该接口，看了看<strong>上下文</strong>，没有找到，<strong>简单跟进了一下调用的函数</strong>，还是没有找到</p>
<p><img src="https://s2.loli.net/2024/10/22/PN8hzcxRsMabTVq.png" alt="image"></p>
<p>然后我又<strong>手翻遍了整个app.js</strong>，并结合上下文仍然<strong>没有</strong>找到任何一处有API接口的参数定义的地方</p>
<p>那么基本可以确定这里单独凭借对JS的搜索与审计是无法找到参数的，<strong>要么是做了某种混淆要么就是参数压根就没有写在前端！</strong></p>
<p>这种情况就只能采用<strong>暴力手段</strong>了，<strong>直接FUZZ参数</strong>试试看能不能找到，使用<strong>Arjun</strong>去FUZZ参数，使用<strong>burp</strong>去FUZZ也一样，重要的是字典和哪个更顺手吧</p>
<p><img src="https://s2.loli.net/2024/10/22/bwWc3P6ot2OZdJV.png" alt="image"></p>
<p>成功找到了几个参数，拼接上去试试看吧</p>
<blockquote>
<p>还有一种方式，就是用自写的小脚本，<strong>提取所有JS文件中的所有单词</strong>，然后再使用<strong>burp</strong>爆破！这样不管你<strong>webpack</strong>打包压缩之后的JS文件有多复杂，参数也大概率就在这些单词之中！但是这次没有找到</p>
</blockquote>
<p>经过几个参数的排列组合，最终发现拼接<strong>limit+page</strong>两个参数可以得到大量数据！</p>
<p><img src="https://s2.loli.net/2024/10/22/P8qVvEHQyemCgU1.png" alt="image"></p>
<p>得到了大量的学校的数据，一共有312页数据，每一页的数据量相当可观！</p>
<p><strong>但是只是得到了大量的该区的幼儿园、小学、中学的学校名称(也是子站点的名称)危害很小，而许多的敏感字段数据都是空白的，应该被脱敏了或者定期清理了吧</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;date&quot;:0,&quot;updateDate&quot;:&quot;&quot;,&quot;trend&quot;:0,&quot;sumNumberSite&quot;:0,&quot;siteName&quot;:&quot;xxxxxxxxxxxxxx&quot;,&quot;delFlag&quot;:&quot;0&quot;,&quot;sumNumberArticle&quot;:0,&quot;listId&quot;:[],&quot;articleNumber&quot;:&quot;&quot;,&quot;updateBy&quot;:null,&quot;enable&quot;:0,&quot;limit&quot;:0,&quot;statusName&quot;:&quot;&quot;,&quot;id&quot;:294,&quot;judge&quot;:&quot;&quot;,&quot;createDate&quot;:&quot;&quot;,&quot;trendDate&quot;:&quot;&quot;,&quot;wxArticleNumber&quot;:&quot;&quot;,&quot;site_token&quot;:&quot;&quot;,&quot;count&quot;:313,&quot;pageBean&quot;:null,&quot;statissList&quot;:&quot;&quot;,&quot;dateNumber&quot;:0,&quot;ipSumber&quot;:0,&quot;sumNumberVisit&quot;:0,&quot;createBy&quot;:null,&quot;name&quot;:&quot;&quot;,&quot;siteId&quot;:0,&quot;page&quot;:0,&quot;remarks&quot;:&quot;&quot;,&quot;startDate&quot;:&quot;&quot;,&quot;stopDate&quot;:&quot;&quot;,&quot;status&quot;:false&#125;,</span><br></pre></td></tr></table></figure>

<p>注意到了这里的参数是<strong>limit+page</strong>，那么肯定想着测测SQL注入咯，于是加单引号触发报错</p>
<p><img src="https://s2.loli.net/2024/10/22/NUr2qXLoGdC4g63.png" alt="image"></p>
<p>好吧，这里把参数值进行了<strong>强制数据类型转化</strong>为了<strong>数字型</strong>，SQL注入没戏了</p>
<p>……</p>
<p><strong>ok，其他的接口也是如法炮制，逐一测试就行，要有耐心</strong></p>
<h2 id="测试成果"><a href="#测试成果" class="headerlink" title="测试成果"></a>测试成果</h2><h3 id="未授权获取全站所有用户名数据"><a href="#未授权获取全站所有用户名数据" class="headerlink" title="未授权获取全站所有用户名数据"></a>未授权获取全站所有用户名数据</h3><p>像这样的数据还有三百多页，每一页的数据量相当可观，前面点的一页有<strong>302条</strong>数据，就算每页<strong>200条</strong>数据，那么粗略估计全站用<strong>siteName</strong>数据就有接近<strong>6w条</strong>，而经过后面的测试发现，<strong>站点登录的用户名正是siteName</strong>，<strong>即该接口可以获取全站接近6w条的用户名！</strong></p>
<p><img src="https://s2.loli.net/2024/10/22/uB7KbqPpxQwr3az.png" alt="image"></p>
<h3 id="未授权删除调查问卷"><a href="#未授权删除调查问卷" class="headerlink" title="未授权删除调查问卷"></a>未授权删除调查问卷</h3><p>这个接口通过路由可以看出来是删除调查问卷的，不算很敏感，于是就尝试了删除</p>
<p><img src="https://s2.loli.net/2024/10/22/kie7HbJN5cAq1Bv.png" alt="image"></p>
<h3 id="任意用户菜单未授权删除"><a href="#任意用户菜单未授权删除" class="headerlink" title="任意用户菜单未授权删除"></a>任意用户菜单未授权删除</h3><p>这个接口是user类的接口，功能是删除，但是还没有确定具体是删除什么东西，由于这个接口比较敏感，便没有轻易尝试FUZZlist</p>
<p>的参数值，而是随意填写了参数值，避免对站点数据造成破坏，<strong>但这里存在删除操作的未授权是无疑的</strong></p>
<p><img src="https://s2.loli.net/2024/10/21/fkXPDcdyehBFnR4.png" alt="image"></p>
<h3 id="未授权保存用户权限"><a href="#未授权保存用户权限" class="headerlink" title="未授权保存用户权限"></a>未授权保存用户权限</h3><p><img src="https://s2.loli.net/2024/10/21/jzICb6wKaFmkH3X.png" alt="image"></p>
<h3 id="查看全站操作日志"><a href="#查看全站操作日志" class="headerlink" title="查看全站操作日志"></a>查看全站操作日志</h3><p>敏感数据还是被脱敏了，可恶(bushi)</p>
<p><img src="https://s2.loli.net/2024/10/22/3ae2UJtFqso8zSN.png" alt="image"></p>
<h3 id="未授权获取大量超级管理员权限"><a href="#未授权获取大量超级管理员权限" class="headerlink" title="未授权获取大量超级管理员权限"></a>未授权获取大量超级管理员权限</h3><p>其中一个接口，<strong>FUZZ</strong>出<strong>site.id</strong>参数名，再去<strong>Burp</strong> <strong>FUZZ</strong>参数值，得到如下结果</p>
<p>终于！在手工逐一看了这么多的接口之后，让我找到了敏感信息，<strong>子站点的超级管理员密码+姓名+电话+登录IP</strong>，而且数据量非常可观</p>
<p><img src="https://s2.loli.net/2024/10/22/Ekw2TgibSCfPysz.png" alt="image"></p>
<p><strong>目测估计有好几百家学校吧</strong></p>
<p>把得到的密码进行解密(也可以不解密，直接在burp发包)，<strong>登录用户名</strong>绝大都是<strong>学校的名称</strong>，只有少部分是自定义的</p>
<p>因为有些密码解密需要购买点数，而且有些密码无法被解密，于是我不想买(穷)，<strong>于是采用直接burp发包的方式登录</strong></p>
<p><img src="https://s2.loli.net/2024/10/22/ptGKSVOjkMzlHma.png" alt="image"></p>
<p><img src="https://s2.loli.net/2024/10/22/o6JrTiqRGcLNAgm.png" alt="image"></p>
<p><strong>非常好，密码是可用的！返回了token！</strong></p>
<p>但是由于是前后端分离的站点，这样手动改包发包，只是能获取查看后端各种接口的权限(Token值)，无法在前端登录进去</p>
<p>于是我还是充了个值，100米</p>
<p><img src="https://s2.loli.net/2024/10/22/QMPXxhAn2peWo9N.png" alt="image"></p>
<p><strong>用解密的密码成功登录！</strong></p>
<p><img src="https://s2.loli.net/2024/10/22/Uqh75RdoZrn16lH.png" alt="image"></p>
<p>到目前我们拿下了几百个站点的<strong>后台或者超级管理员权限</strong>，但是感觉还是不够，想进一步扩大危害：</p>
<p>前面不是提到有一个接口可以未授权查看全<strong>siteName</strong>吗，而这个<strong>siteName</strong>就是大部分站点的登录的用户名，而且在刚刚解密密码时，<strong>又发现一个密码是直接与整个站群系统的缩写有关的密码，而且有不少站点都使用着这个有特征的密码</strong>，于是大胆推测这个密码就是该站点的<strong>默认密码</strong>！那么就好办了，直接写python脚本，提取出全站的用户名(<strong>siteName</strong>)，再固定<strong>默认密码</strong>去登录发包爆破，从而得到更多数量的<strong>后台或者超级管理员权限！</strong></p>
<p>既然进了后台，那么就对后台测测看吧</p>
<h2 id="进一步测试"><a href="#进一步测试" class="headerlink" title="进一步测试"></a>进一步测试</h2><p>进入任意一个后台……</p>
<p>先是把所有的功能点触发一遍，让流量经过<strong>burp</strong>，抓到尽可能多的数据包，并开启一些常用的插件进行被动扫描敏感信息，提取指纹，识别Nday等等</p>
<h3 id="水平越权获取大量敏感信息"><a href="#水平越权获取大量敏感信息" class="headerlink" title="水平越权获取大量敏感信息"></a>水平越权获取大量敏感信息</h3><p><img src="https://s2.loli.net/2024/10/22/WFL4g2S7cVjblrX.png" alt="image"></p>
<p>直接改ID</p>
<p><img src="https://s2.loli.net/2024/10/22/Bs4CXUWF9KIvuk5.png" alt="image"></p>
<p>直接就返回了另外学校的数据：<strong>学校名+电话+wxid+wx_accessToken+地址+wxSecret</strong></p>
<p><img src="https://s2.loli.net/2024/10/22/oYTJ1wiCWvRbmN4.png" alt="image"></p>
<p><img src="https://s2.loli.net/2024/10/22/DJSy28MvCNKdfOb.png" alt="image"></p>
<p>那么遍历一下id，就可以获取到全站学校的<strong>学校名+电话+wxid+wx_accessToken+地址+wxSecret</strong>！</p>
<h3 id="拿下主站点的超级管理员权限"><a href="#拿下主站点的超级管理员权限" class="headerlink" title="拿下主站点的超级管理员权限"></a>拿下主站点的超级管理员权限</h3><p>前面提到拿下了大量的子站点的权限，大概是这样：</p>
<p>111.test.com  张三小学</p>
<p>222.test.com 李四小学</p>
<p>这些都是test.com的子域名，那么肯定有主域名啊，于是我推测主域名下就是该站群的主站点的后台系统</p>
<p>子站点是该区的幼儿园、小学、中学的站点，那么主站点就是这些站点的上级吧，比如教育局、什么什么中心之类的甚至是该站群的供应商</p>
<p>于是我就去查这个<strong>站群的备案，得到了该站群系统的名称</strong>，因为我觉得主站点的名称肯定与这个有关</p>
<p>然后我就再去<strong>手翻之前泄露密码的接口</strong>，<strong>看看能不能找到与这个备案主体类似的名称</strong></p>
<p>果然被我找到了一个类似的名称，登录看看</p>
<p><img src="https://s2.loli.net/2024/10/22/YdGqDsHfyWSNk8g.png" alt="image"></p>
<p>好家伙，果然找到了主后台！</p>
<p><strong>数据量更大一些，也比子站点更重要！</strong></p>
<p><img src="https://s2.loli.net/2024/10/22/XRUMBmkOhs2T56I.png" alt="image"></p>
<p>经过基本的测试，没有发现注入漏洞，上传漏洞，因为上传功能点失效了，无XSS，等等一系列的基础漏洞，但存在<strong>大量越权、未授权接口</strong>，Over</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://x1lys.github.io">X1ly?S</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://x1lys.github.io/2024/08/20/%E4%BB%8EJS%E6%8E%A5%E5%8F%A3%E5%88%B0%E6%8B%BF%E4%B8%8B%E5%A4%A7%E9%87%8F%E5%AD%A6%E6%A0%A1%E7%9A%84%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90/">https://x1lys.github.io/2024/08/20/从JS接口到拿下大量学校的超级管理员权限/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://x1lys.github.io" target="_blank">X1ly?S</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%B8%97%E9%80%8F%E6%A1%88%E4%BE%8B/">渗透案例</a></div><div class="post-share"><div class="social-share" data-image="/img/1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>技术交流，互相学习</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://wpa.qq.com/msgrd?v=3&amp;uin=2382247834&amp;site=qq&amp;menu=yes" target="_blank"><img class="post-qr-code-img" src="/img/52.jpg" alt="联系我"/></a><div class="post-qr-code-desc">联系我</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/08/31/taoCMS%E5%90%8E%E5%8F%B0%E6%B3%A8%E5%85%A5/" title="taoCMS-后台注入"><img class="cover" src="/img/1.jpg" onerror="onerror=null;src='/img/18.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">taoCMS-后台注入</div></div><div class="info-2"><div class="info-item-1">环境搭建 我用的是 phpstudy2018+php-5.4.45+Apache   白盒审计 手工审计  审计思路选择由于功能点太多了，于是果断pass掉功能点审计法与SQL语句监控法，因为功能点太多，那么需要触发的SQL语句也会很多，一时半会还真不好找，于是我选择正则表达式审计法  1(?:SELECT|INSERT INTO|UPDATE|DELETE FROM|CREATE TABLE|DROP TABLE|ALTER TABLE)\b[\s\S]*?;   一共匹配到的有效SQL语句也就30来条左右，通过简单看看这些SQL语句，又可以排除大部分明显不可控的固定的SQL语句，那么剩下的就一条一条验证看是否可控 最终觉得 **\include\Model\Datastore.php **这个文件中的一处SQL语句有点可疑 开始着重审计 审计过程123456789101112131415161718192021function create()&#123;		header(&#x27;Content-type:...</div></div></div></a><a class="pagination-related" href="/2024/08/18/%E5%85%8D%E6%9D%80Day-1/" title="免杀Day-1"><img class="cover" src="/img/1.jpg" onerror="onerror=null;src='/img/18.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">免杀Day-1</div></div><div class="info-2"><div class="info-item-1">杀毒软件检测⽅式静态查杀特征码扫描机制：杀毒软件使用病毒数据库中的特征码（也称为病毒指纹）来检测已知的恶意软件。当杀毒软件扫描系统中的文件时，它会将文件的内容与特征码进行比对。如果匹配成功，文件将被标记为恶意软件。 优点：特征码扫描对已知的恶意软件非常有效，能够快速检测和处理。 缺点：对于未知或变种的恶意软件，特征码扫描可能无法检测到，因为这些恶意软件可能不包含数据库中的特征码。 ⽂件校验和每个文件都可以通过特定的哈希算法（如...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/04/13/%E4%B8%8D%E6%98%AF%E5%93%A5%E4%BB%AC%E5%8C%97%E5%A4%A7%E8%A2%ABRCE%E4%BA%86/" title="不是哥们？北大被&quot;RCE&quot;了"><img class="cover" src="/img/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-13</div><div class="info-item-2">不是哥们？北大被&quot;RCE&quot;了</div></div><div class="info-2"><div class="info-item-1">前言团队的师傅突然发来一句，”要RCE北大了”，还配上了一个截图，是执行了ls /的全回显结果，卧槽，我直呼牛逼，当时就兴奋了，于是我那天晚上忙(耍)完也去对北大做了信息收集，想去找找看这位师傅所说的可以RCE的站点，后面确实被”RCE”了，觉得有点意思，于是有了这篇文章。 信息收集就不说了，收集下来几千条资产。根据那位师傅的描述，他说那个系统就是类似于”PTA”在线编程系统的，于是结合这个信息，对子域名进行了简单的排查，推测并快速定位到了某一个系统，点开一看，就是在线做一些编程题目的，那么八九不离十就是这个系统了  哟西，可以注册，黑客狂喜(bushi)，注册一个测试账号 直接来到题目做题，因为这里做编程题，不就是能执行我们编写的代码嘛？根据那位师傅的截图，推测肯定是这里编写程序时可以执行系统命令导致的”RCE”  选一个最简单的经典hello word   预期的是这样子，输出一个”hello...</div></div></div></a><a class="pagination-related" href="/2025/01/10/%E4%BB%8E%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E5%88%B0%E4%B8%8A%E7%BA%BFCS/" title="从任意文件读取到上线CS"><img class="cover" src="/img/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-01-10</div><div class="info-item-2">从任意文件读取到上线CS</div></div><div class="info-2"><div class="info-item-1">前言记录一次稍微有点崎岖的渗透实战，看我如果从任意文件读取到上线CS 渗透过程信息收集一顿信息收集后，终于找到了这样一个资产，熟悉的师傅可能一眼就看出来了，这是fastadmin，对！没错，当我看到这个fastadmin的时候，就有预感要出货了……  先是试了一下弱口令，因为fastadmin中管理员忘记密码时，会去数据库中手动重置密码，默认重置的密码一般都是123456 尝试了admin 123456不行，接下来干嘛呢？ 肯定不是按照常规的思路去测什么登录框SQL注入，js里的未授权接口等等，因为这个是一个fastadmin框架啊，这种肯定是直接打Nday最有效撒，于是我们去收集一下fastadmin都有哪些Nday？   fastadmin Nday列举  下面简单列举一下几个Nday，不作详细解释，附上文章链接 任意文件读取 https://cloud.tencent.com/developer/article/2432376  可以读取数据库配置信息，可用来连接数据库 1GET...</div></div></div></a><a class="pagination-related" href="/2024/05/04/%E6%84%8F%E5%A4%96%E5%8F%91%E7%8E%B0CVE-XSS%E3%80%81%E6%8C%82%E9%BB%91%E9%A1%B5%E3%80%81%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/" title="意外发现CVE-XSS、挂黑页、文件删除"><img class="cover" src="/img/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-05-04</div><div class="info-item-2">意外发现CVE-XSS、挂黑页、文件删除</div></div><div class="info-2"><div class="info-item-1"> 前言：水一篇文章……没有什么价值与技术含量，望各位大佬轻喷。挖掘EDU时，偶然搜集到学校老师的个人网站，是一个文件共享系统，但是可惜该文件共享服系统与学校业务无关，是一些个人的工作、生活文件和一些源码压缩包。存在一些漏洞：反射型xss，存储型xss，文件上传html-挂黑页，文件删除，但是没有任何用哈哈，个人网站不算重要资产(除非涉及企业敏感信息)，影响几乎忽略不计。但是凭借这个文件系统的指纹，如果找到一些存有重要文件的该系统，那不就可以中危、高危提交了吗？  造成漏洞的主要原因其实没啥，全凭运气。那就是该文件共享系统被设置成了，允许访客执行所有操作！是的，不用登录，就有权限执行所有操作！归类的话，就算是权限、访问控制不当。因为本来安全的配置是只能允许访客下载文件的。 于是导致了： 漏洞复现任意文件删除 文件上传html钓鱼 挂黑页 存储型XSS...</div></div></div></a><a class="pagination-related" href="/2024/06/10/%E6%9F%90%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%9F%B9%E8%AE%AD%E6%9C%BA%E6%9E%84%E7%9A%84%E6%95%99%E5%AD%A6%E5%B9%B3%E5%8F%B0%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81%E5%A4%84%E5%AD%98%E5%9C%A8%E9%80%BB%E8%BE%91%E7%BC%BA%E9%99%B7%E6%BC%8F%E6%B4%9E/" title="某网络安全培训机构的教学平台修改密码处存在逻辑缺陷漏洞"><img class="cover" src="/img/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-10</div><div class="info-item-2">某网络安全培训机构的教学平台修改密码处存在逻辑缺陷漏洞</div></div><div class="info-2"><div class="info-item-1"> 前言：第一次遇到这么奇葩的漏洞，故想记录一下，可惜后面没有危害提升成功，只是一个低危（但其实没有什么危害哈哈，只是很奇葩，打破了我”看上去就做得特别好的网站或者做网安的网站不存在漏洞”的天真认知，哈哈），要是能CSRF绝对高危。因为刚出这个漏洞，厂商还未修复，不得不厚码。但是不影响看思路（其实也没有啥思路可言），目标是一家有些名气的某网络安全培训机构的教学平台  漏洞URLhttps://xxxx.yyyyyy.com/login （你还真点了啊【狗头保命】） 漏洞复现 登录一个测试账号    进入平台，来到 个人设置 –&gt; 修改密码处    看到需要填写原始密码 新密码 确认密码三项（最初我怎么发现这里有问题的呢？就是我把这三项都填相同的任意字符串时，发现提示：修改密码成功，于是我就笃定这里的代码肯定写得有问题！）   我当前正确的原始密码是：admin123，但是当我 “原始密码 新密码 确认密码”三项都填写：123456 时，返回了修改密码成功！！！     于是尝试使用密码：123456...</div></div></div></a><a class="pagination-related" href="/2025/04/13/%E7%BB%95WAF%E8%BF%9E%E6%96%A9%E4%B8%A4%E6%9E%9A%E6%B5%B7%E5%A4%96XSS/" title="硬刚世界500强企业WAF，连斩两枚海外XSS"><img class="cover" src="/img/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-13</div><div class="info-item-2">硬刚世界500强企业WAF，连斩两枚海外XSS</div></div><div class="info-2"><div class="info-item-1">...</div></div></div></a><a class="pagination-related" href="/2025/04/13/%E8%8F%A0%E8%8F%9C%E6%B8%97%E9%80%8F%E5%B0%8F%E9%80%9A%E6%9D%80%E6%A1%88%E4%BE%8B/" title="菠菜？那很坏了！菠菜渗透小通杀案例"><img class="cover" src="/img/1.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-13</div><div class="info-item-2">菠菜？那很坏了！菠菜渗透小通杀案例</div></div><div class="info-2"><div class="info-item-1">前言公众号的粉丝、一位大师傅发来一个站，问我有没有兴趣试试，我点开一看，哇靠，这不是菠菜嘛，太坏了，必须渗透一下，于是有了这篇小通杀案例  初见端倪简单看了看各个功能点，大部分是一些静态展示内容，有少量的查询数据的功能，于是首先想到打SQL注入 直接来到一处查询功能点  输入admin，有数据正常回显  输入admin’，没有数据回显  抓个包看看  好家伙，狗运来了挡都挡不住，直接SQL报错了 经过手工测试发现没有waf，直接sqlmap跑可以了撒  到此，可以直接拿到整个数据库的全部数据，可以拿到后台管理员表，几个密码哈希值，5K+的姓名，会员号，银行卡号，初始密码，取款密码，资金流水等等数据   但是还不够，于是我进一步尝试getshell 经过漫长的测试发现：  目标是MySQL数据库 通过TP框架报错信息得到了网站根目录绝对路径 没有使用站库分离架构 目录没有写入文件权限 能够通过sqlmap获取sql-shell，但是数据库权限很低，只能执行一些有限的当前数据库的数据查询  对于MySQL，无非就两种常用的方式getshell，into...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/11.jpg" onerror="this.onerror=null;this.src='/img/47.jpg'" alt="avatar"/></div><div class="author-info-name">X1ly?S</div><div class="author-info-description">需要的不是掌声，而是没有哭声</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">90</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">50</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">20</div></a></div><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/x1lys" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:2382247834@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://wpa.qq.com/msgrd?v=3&amp;uin=2382247834&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq" style="color: #00b7f1;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">更多优质技术文章，欢迎关注【The One安全】微信公众号</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86"><span class="toc-number">1.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%B5%8B%E8%AF%95%E6%B5%81%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">基本测试流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API%E6%8E%A5%E5%8F%A3%E6%8F%90%E5%8F%96"><span class="toc-number">3.</span> <span class="toc-text">API接口提取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95"><span class="toc-number">4.</span> <span class="toc-text">API接口测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%88%90%E6%9E%9C"><span class="toc-number">5.</span> <span class="toc-text">测试成果</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E6%8E%88%E6%9D%83%E8%8E%B7%E5%8F%96%E5%85%A8%E7%AB%99%E6%89%80%E6%9C%89%E7%94%A8%E6%88%B7%E5%90%8D%E6%95%B0%E6%8D%AE"><span class="toc-number">5.1.</span> <span class="toc-text">未授权获取全站所有用户名数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E6%8E%88%E6%9D%83%E5%88%A0%E9%99%A4%E8%B0%83%E6%9F%A5%E9%97%AE%E5%8D%B7"><span class="toc-number">5.2.</span> <span class="toc-text">未授权删除调查问卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E8%8F%9C%E5%8D%95%E6%9C%AA%E6%8E%88%E6%9D%83%E5%88%A0%E9%99%A4"><span class="toc-number">5.3.</span> <span class="toc-text">任意用户菜单未授权删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E6%8E%88%E6%9D%83%E4%BF%9D%E5%AD%98%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90"><span class="toc-number">5.4.</span> <span class="toc-text">未授权保存用户权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%85%A8%E7%AB%99%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97"><span class="toc-number">5.5.</span> <span class="toc-text">查看全站操作日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%AA%E6%8E%88%E6%9D%83%E8%8E%B7%E5%8F%96%E5%A4%A7%E9%87%8F%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90"><span class="toc-number">5.6.</span> <span class="toc-text">未授权获取大量超级管理员权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E4%B8%80%E6%AD%A5%E6%B5%8B%E8%AF%95"><span class="toc-number">6.</span> <span class="toc-text">进一步测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B0%B4%E5%B9%B3%E8%B6%8A%E6%9D%83%E8%8E%B7%E5%8F%96%E5%A4%A7%E9%87%8F%E6%95%8F%E6%84%9F%E4%BF%A1%E6%81%AF"><span class="toc-number">6.1.</span> <span class="toc-text">水平越权获取大量敏感信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%BF%E4%B8%8B%E4%B8%BB%E7%AB%99%E7%82%B9%E7%9A%84%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90"><span class="toc-number">6.2.</span> <span class="toc-text">拿下主站点的超级管理员权限</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/29/Memcached%E6%9C%AA%E6%8E%88%E6%9D%83/" title="Memcached未授权漏洞"><img src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/18.jpg'" alt="Memcached未授权漏洞"/></a><div class="content"><a class="title" href="/2025/04/29/Memcached%E6%9C%AA%E6%8E%88%E6%9D%83/" title="Memcached未授权漏洞">Memcached未授权漏洞</a><time datetime="2025-04-28T17:08:22.000Z" title="发表于 2025-04-29 01:08:22">2025-04-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/13/%E7%BB%95WAF%E8%BF%9E%E6%96%A9%E4%B8%A4%E6%9E%9A%E6%B5%B7%E5%A4%96XSS/" title="硬刚世界500强企业WAF，连斩两枚海外XSS"><img src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/18.jpg'" alt="硬刚世界500强企业WAF，连斩两枚海外XSS"/></a><div class="content"><a class="title" href="/2025/04/13/%E7%BB%95WAF%E8%BF%9E%E6%96%A9%E4%B8%A4%E6%9E%9A%E6%B5%B7%E5%A4%96XSS/" title="硬刚世界500强企业WAF，连斩两枚海外XSS">硬刚世界500强企业WAF，连斩两枚海外XSS</a><time datetime="2025-04-13T15:03:17.000Z" title="发表于 2025-04-13 23:03:17">2025-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/13/%E8%8F%A0%E8%8F%9C%E6%B8%97%E9%80%8F%E5%B0%8F%E9%80%9A%E6%9D%80%E6%A1%88%E4%BE%8B/" title="菠菜？那很坏了！菠菜渗透小通杀案例"><img src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/18.jpg'" alt="菠菜？那很坏了！菠菜渗透小通杀案例"/></a><div class="content"><a class="title" href="/2025/04/13/%E8%8F%A0%E8%8F%9C%E6%B8%97%E9%80%8F%E5%B0%8F%E9%80%9A%E6%9D%80%E6%A1%88%E4%BE%8B/" title="菠菜？那很坏了！菠菜渗透小通杀案例">菠菜？那很坏了！菠菜渗透小通杀案例</a><time datetime="2025-04-13T15:00:58.000Z" title="发表于 2025-04-13 23:00:58">2025-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/13/%E4%B8%8D%E6%98%AF%E5%93%A5%E4%BB%AC%E5%8C%97%E5%A4%A7%E8%A2%ABRCE%E4%BA%86/" title="不是哥们？北大被&quot;RCE&quot;了"><img src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/18.jpg'" alt="不是哥们？北大被&quot;RCE&quot;了"/></a><div class="content"><a class="title" href="/2025/04/13/%E4%B8%8D%E6%98%AF%E5%93%A5%E4%BB%AC%E5%8C%97%E5%A4%A7%E8%A2%ABRCE%E4%BA%86/" title="不是哥们？北大被&quot;RCE&quot;了">不是哥们？北大被&quot;RCE&quot;了</a><time datetime="2025-04-13T14:49:58.000Z" title="发表于 2025-04-13 22:49:58">2025-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/02/12/ArcGis%E6%BC%8F%E6%B4%9E/" title="ArcGis漏洞"><img src="/img/1.jpg" onerror="this.onerror=null;this.src='/img/18.jpg'" alt="ArcGis漏洞"/></a><div class="content"><a class="title" href="/2025/02/12/ArcGis%E6%BC%8F%E6%B4%9E/" title="ArcGis漏洞">ArcGis漏洞</a><time datetime="2025-02-12T06:39:45.000Z" title="发表于 2025-02-12 14:39:45">2025-02-12</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/1.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2024 - 2025 By X1ly?S</div><div class="footer_custom_text">我的来时路</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><div class="js-pjax"><script>(() => {
  let initFn = window.walineFn || null
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const destroyWaline = ele => ele.destroy()

  const initWaline = (Fn, el = document, path = window.location.pathname) => {
    const waline = Fn({
      el: el.querySelector('#waline-wrap'),
      serverURL: 'https://comments-swart.vercel.app/',
      pageview: false,
      dark: 'html[data-theme="dark"]',
      comment: true,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    if (isShuoshuo) {
      window.shuoshuoComment.destroyWaline = () => {
        destroyWaline(waline)
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const loadWaline = (el, path) => {
    if (initFn) initWaline(initFn, el, path)
    else {
      btf.getCSS('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.css')
        .then(() => import('https://cdn.jsdelivr.net/npm/@waline/client/dist/waline.min.js'))
        .then(({ init }) => {
          initFn = init || Waline.init
          initWaline(initFn, el, path)
          window.walineFn = initFn
        })
    }
  }

  if (isShuoshuo) {
    'Waline' === 'Waline'
      ? window.shuoshuoComment = { loadComment: loadWaline } 
      : window.loadOtherComment = loadWaline
    return
  }

  if ('Waline' === 'Waline' || !false) {
    if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
    else setTimeout(loadWaline, 0)
  } else {
    window.loadOtherComment = loadWaline
  }
})()</script></div><script>(() => {
  const isChatBtn = false
  const isChatHideShow = false

  if (isChatBtn) {
    const close = () => {
      Chatra('minimizeWidget')
      Chatra('hide')
    }

    const open = () => {
      Chatra('openChat', true)
      Chatra('show')
    }

    window.ChatraSetup = { startHidden: true }
  
    window.chatBtnFn = () => {
      document.getElementById('chatra').classList.contains('chatra--expanded') ? close() : open()
    }
  } else if (isChatHideShow) {
    window.chatBtn = {
      hide: () => Chatra('hide'),
      show: () => Chatra('show')
    }
  }

  (function(d, w, c) {
    w.ChatraID = ''
    var s = d.createElement('script')
    w[c] = w[c] || function() {
      (w[c].q = w[c].q || []).push(arguments)
    }
    s.async = true
    s.src = 'https://call.chatra.io/chatra.js'
    if (d.head) d.head.appendChild(s)
  })(document, window, 'Chatra')
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>